## Makefile to install OCS from the sources
## @configure_input@
#  Copyright 1989 - 1999 by the Opal Group, TU Berlin. All rights reserved
#  See OCSHOME/etc/LICENSE or 
#  http://uebb.cs.tu-berlin.de/~opal/LICENSE.html for details


.PHONY: install default usage

default: usage

srcdir=@srcdir@

## define these variables to match your system
#.. Path to the source of the distribution
OCSSRC=@ocs_abssrcdir@/src
#.. Absolute path to the ProjectDefs file in this directory
OCSPROJECT=@ocs_abssrcdir@/ProjectDefs
#.. Path to the place where the distribution is to be installed
OCSHDIR=ocs-$(VERSION)
OCSHOME=@prefix@/$(OCSHDIR)
#.. Description of your system 
OSARCH=@host_os@-@host_cpu@
#.. Path to the GNU sed program
SED=@ac_cv_path_SED@
#.. Path to the GNU tar program
TAR=@ac_cv_path_TAR@
#.. Path to the GNU zip program
GZIP=@ac_cv_path_COMPRESS@ -f
#.. Non-vital components of the Opal system (do not change order)
# lib.opal_parserlight lib.opal_readline lib.opal_java
# lib.opal_tcl lib.opal_tk lib.opal_win 
# pkg.dynamite lib.oc_reflections 
# pkg.browser pkg.emacs pkg.dosfop pkg.doc pkg.ordinatrice 
# pkg.oasys pkg.tivi2 
STDPACKAGES = @ocs_std_packages@


## don't change anything beyond this line ##############################

#.. Version of the Opal distribution
VERSION=@ocs_version@

#.. name of the distribution archives
SRCDISTR=ocs-$(VERSION)-src
SHAREDDISTR=ocs-$(VERSION)-shared
BINDISTR=ocs-$(VERSION)-bin-$(OSARCH)

#.. Packages which are to be installed (in the given order!)
INITPACKAGES = pkg.om
MINPACKAGES = pkg.opalimports lib.opal_base pkg.genmake \
	      lib.oc_shared lib.oc_oc1 lib.oc_oc2 pkg.oc1 pkg.oc2 
MINSRCPACKAGES	=	pkg.examples
PACKAGES = $(MINPACKAGES) $(STDPACKAGES)

OCSADMIN=$(OCSHOME)/bin/ocsadmin -ocshome $(OCSHOME) -ocssrc $(OCSSRC) -ocsspecs $(OCSSRC)/om/specs
OCSADMININIT=$(OCSSRC)/om/scripts/ocsadmin -ocssrc $(OCSSRC) -ocshome $(OCSHOME) -ocsspecs $(OCSSRC)/om/specs

install: init $(PACKAGES)
	$(OCSADMIN) install $(MINSRCPACKAGES)

init:
	$(OCSADMININIT) init -sed $(SED) $(VERSION)
	$(OCSADMIN) install $(INITPACKAGES)

pkg.% lib.%:
	$(OCSADMIN) ocs $@
	$(OCSADMIN) install $@

pkg.examples:
	$(OCSADMIN) install $@

boot: $(MINPACKAGES)
	$(OCSADMIN) install $(MINSRCPACKAGES)

complete: $(STDPACKAGES)

# distclean:
# 	$(OCSADMININIT) ocs -command cleanobjall $(MINPACKAGES)
#	$(OCSADMININIT) ocs -command cleanall $(MINSRCPACKAGES) $(STDPACKAGES)

distclean:
	(cd $(OCSSRC)/om; ocs cleanobjall)
	(cd $(OCSSRC)/oc; ocs cleanobjall)
	(cd $(OCSSRC)/lib; ocs cleanobjall)
	(cd $(OCSSRC)/oc/dynamite; ocs cleanall)
	(cd $(OCSSRC)/oc/reflections; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/OpalWin; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/OpalWinAdditions; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/ParserLight; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/Readline; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/Tcl; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/Tk; ocs cleanall)
	(cd $(OCSSRC)/lib/Tools/Java; ocs cleanall)
	(cd $(OCSSRC)/browser; ocs cleanall)
	(cd $(OCSSRC)/dosfop; ocs -P $(OCSSRC)/dosfop/ProjectDefs.dosfop cleanall)
	(cd $(OCSSRC)/emacs; ocs cleanall)
	(cd $(OCSSRC)/oasys; ocs cleanall)
	(cd $(OCSSRC)/ordinatrice; ocs cleanall)
	(cd $(OCSSRC)/tivi2; ocs cleanall)
	(cd $(OCSSRC)/../doc; ocs cleanall)

preparedist:
	(cd $(OCSSRC)/lib; ocs cleanall; OCSSRC=$(OCSSRC); export OCSSRC; ocs -P $(OCSSRC)/ProjectDefs.bootstrap) && (cd $(OCSSRC)/om; ocs cleanall; OCSSRC=$(OCSSRC); export OCSSRC; ocs -P $(OCSSRC)/ProjectDefs.bootstrap) && (cd $(OCSSRC)/oc; ocs cleanall; OCSSRC=$(OCSSRC); export OCSSRC; ocs -P $(OCSSRC)/ProjectDefs.bootstrap)

sourcedistr:
	cp -f ignore1  /tmp; cp -f ignore2  /tmp; \
	cd $(OCSSRC)/../.. ; \
	$(TAR) -X /tmp/ignore1 -X /tmp/ignore2 -cvf $(SRCDISTR).tar ocs/src; \
	$(TAR) -X /tmp/ignore1 \
		-X /tmp/ignore2 -rvf $(SRCDISTR).tar ocs/examples; \
	$(TAR) -X /tmp/ignore1 -rvf $(SRCDISTR).tar ocs/doc ocs/Makefile.in ocs/configure ocs/config.guess ocs/config.sub ocs/install-sh ocs/ocs-version ocs/ignore1 ocs/ignore2 ; \
	$(GZIP) $(SRCDISTR).tar; \
	rm /tmp/ignore1; rm /tmp/ignore2

bindistr:
	$(TAR) -cvf $(OCSSRC)/../../$(BINDISTR).tar -C $(OCSHOME)/.. $(OCSHDIR)/bin $(OCSHDIR)/dosfop $(OCSHDIR)/packages $(OCSHDIR)/lib ; \
	$(GZIP) $(OCSSRC)/../../$(BINDISTR).tar

shareddistr:
	$(TAR) -cvf $(OCSSRC)/../../$(SHAREDDISTR).tar -C $(OCSHOME)/.. $(OCSHDIR)/VERSION $(OCSHDIR)/doc $(OCSHDIR)/etc $(OCSHDIR)/examples $(OCSHDIR)/man ; \
	$(GZIP) $(OCSSRC)/../../$(SHAREDDISTR).tar

usage:
	@echo "usage: first edit the variables at the beginning of Makefile"
	@echo "then call 'make install'"

### for autoconf

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck